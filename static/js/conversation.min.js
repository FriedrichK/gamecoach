var conversationApp=angular.module("conversationApp",["gamecoachShared","gamecoachNavigation"]),conversationApp=angular.module("conversationApp");conversationApp.controller("SubmissionController",function(a,b,c){b.submit=function(){var b=$("input[type=hidden][name=conversationPartner]").val(),d=angular.element("textarea[name=field]").val();d&&""!==d&&c.postMessage(b,d,function(b){200===b.status&&(angular.element("textarea[name=field]").val(""),a.$broadcast("newMessageSuccessfullySent"))})}}),conversationApp.controller("OtherUserProfileController",function(a,b,c,d,e,f,g,h){var i=$("input[type=hidden][name=conversationPartner]").val();BaseProfileController.call(this,a,b,c,d,e,f,g,h,i),a.goToProfile=function(){window.location="/mentor/"+i}}),conversationApp.controller("MessageController",function(a,b,c,d,e){var f=$("input[type=hidden][name=conversationPartner]").val(),g=function(){d.getConversation(null,f,function(b){a.messageStream=e.format(b)})};angular.element(b).ready(function(){g()}),c(function(){g()},3e3),a.$on("newMessageSuccessfullySent",function(){g()})}),conversationApp.controller("InboxController",function(a,b,c,d,e){var f=function(){var b=$("input[type=hidden][name=system_username]").val();d.getInbox(function(c){var d=e.format(c,b);d&&d.length>0&&(a.inbox=d)})};angular.element(b).ready(function(){f()}),c(function(){f()},3e3),a.goToConversation=function(a,b){var c=$("input[type=hidden][name=system_username]").val();console.log(a,b,c,a===c);var d=a;a===c&&(d=b),window.location="/conversation/"+d}});var conversationApp=angular.module("conversationApp");conversationApp.factory("conversationService",function(a){return{getConversation:function(b,c,d){return a({url:"/api/conversation/"+c,method:"GET",params:{ident:b}}).then(function(a){d(a.data)})}}}),conversationApp.factory("messageService",function(a){return{postMessage:function(b,c,d){return a({url:"/api/conversation/message/",method:"POST",data:{recipient:b,message:c}}).then(function(a){d(a)})}}}),conversationApp.factory("inboxService",function(a){return{getInbox:function(b){return a({url:"/api/conversation/",method:"GET"}).then(function(a){b(a.data)})}}}),conversationApp.factory("messageStreamFormattingService",function(a,b){var c=function(a,b){return b.other_username=b.sender.username,b.other_username2=b.sender.username2,b.sender.username===a&&(b.other_username=b.recipient.username,b.other_username2=b.recipient.username2),b},d=function(a,d){var e=[];return angular.forEach(a,function(a){d&&(a=c(d,a)),e.push(b.formatMessageDate(a))}),e};return{format:function(a,b){return d(a,b)}}});